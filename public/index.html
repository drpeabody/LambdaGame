<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>The Lambda Game</title>
	<style type="text/css">
		body {
			background: #112;
		}
		canvas {
			border : 0px;
		}
		#login-form {
			color: #fff;
			margin-top: 40vh;
			text-align: center;
		}
		.row {
			overflow-x: hidden;
			width: 100%;
			margin: 40px 0 0 0;
		}
		.label {
			font-size: 2em;
			margin-bottom: 5vh;
		}
	</style>
</head>
<body>
	<div id="login-form">
		<label id="input-form-label" class="label">Enter your username if you are logging in for the First Time, or your Hash Key if you already have an account. </label>
		<div class="row">
			Username: <input type="text" name="UserName" id="username">
		</div>

		<div class="row">
			Key : <input type="Password" name="Password" id="password">
		</div>
		<div class="row">
			<input type="button" value="Register" id="btn-register">
			<input type="button" value="Login" id="btn-login">
		</div>
	</div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
<script type="text/javascript">
	g = (id) => document.getElementById(id);
	hasAskedOnce = false;
	var playerSquareSize = 50 ;
	connect = (id) => {
		// io.origins('*:*');
		// socket = io('http://192.168.110.68:8080/', {id: id, pwd: pwd});
		// socket = io('http://192.168.0.130:8080/', {id: id});
		socket = io('http://localhost:8080/', {id: id});
		socket.emit('Username', id);
		socket.on('AccountExists', function(doesAccountExist) {
			g('input-form-label').innerHTML = 'This username already exists';
		});
		
		socket.on('MapGen', function(data) {
			document.body.innerHTML = '';
			var canvas = document.createElement('canvas');
			// Get the canvas element form the page
			canvas.id = "CursorLayer";
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			var canvaswidth = canvas.width;
			var canvasheight = canvas.height ;
			canvas.style.position = "absolute";
			var body = document.getElementsByTagName("body")[0];
			body.appendChild(canvas);
			console.log(canvaswidth);
			console.log(canvasheight);
			socket.emit('WindowDetails', {widthy: Number(canvaswidth), heighty:Number(canvasheight)});
			cursorLayer = document.getElementById("CursorLayer");
			var ctx = canvas.getContext("2d");
			ctx.fillStyle = "#7cfc00";
			// Code to populate canvas
			for (var y = 0 ; y < canvas.height ; y++)
			{
				for (var x = 0 ; x < canvas.width ; x++)
				{
					ctx.fillRect(x, y, 1, 1);
				}
			}
			for (var i = 0 ; i < data.list.length ; i++)
			{
				if (data.list[i].x >= data.actualX && data.list[i].x <= (data.actualX+canvaswidth) && (data.list[i].y >= data.actualY && data.list[i].y <= (data.actualY-canvasheight)))
				{
					ctx.fillStyle = data.list[i].color ;
					ctx.fillRect(data.actualX-data.list[i].x, data.actualY-data.list[i].y, data.list[i].l, data.list[i].b);
					console.log("Got inside");
				}				
			}
								
			ctx.fillStyle = "#000000";
			ctx.fillRect((canvas.width-playerSquareSize)/2, (canvas.height-playerSquareSize)/2, playerSquareSize, playerSquareSize);
			
			document.onkeydown = function(evt) {
		    	evt = evt || window.event;
		    	if (evt.keyCode == 87 || evt.keyCode == 197 || evt.keyCode == 65 || evt.keyCode == 97 || evt.keyCode == 83 || evt.keyCode == 115 || evt.keyCode == 68 || evt.keyCode == 100) {
					socket.emit("ChangeCamera", {keycode : evt.keyCode});
					console.log("SHIT");
    			}
			};
		});
		// socket.on('news', function (data) {
		// 	console.log(data);
		// 	socket.emit('my other event', { my: 'data' });
		// });
	}
	// connectPwd = (pwd) => {
	// 	// io.origins('*:*');
	// 	// socket = io('http://192.168.110.68:8080/', {id: id, pwd: pwd});
	// 	socket = io('http://localhost:8080/', {pwd: pwd});
	// 	socket.on('news', function (data) {
	// 		console.log(data);
	// 		socket.emit('my other event', { my: 'data' });
	// 	});
	// }

	g('btn-register').addEventListener('click', () => {
		var name = g('username').value;
		if(!name|| name === ''){
			g('input-form-label').innerHTML = 'Please Enter a valid Username';
			return;
		}
		if(hasAskedOnce){
			g('input-form-label').innerHTML = 'Please wait while we register you with our servers.';
			connect(name);
		} else {
			g('input-form-label').innerHTML = 'Please Reconfirm Your Password (without your '+
			'password you will lose access to your inventory) and click Register again.';
			hasAskedOnce = true;
		}
	});

	g('btn-login').addEventListener('click', () => {
		// var pass = g('password').value ;
		// if (!pass || pass === '')
		// {
		// 	g('input-form-label').innerHTML = 'Please enter a valid password';
		// 	return ;
		// }

	});
</script>
</html>